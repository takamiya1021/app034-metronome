# 📋 要件定義書：No.34「メトロノーム」

**作成日**: 2025-01-13
**バージョン**: 1.0
**アプリ番号**: 34

---

## 1. プロジェクト概要

### 1.1 アプリ名
**メトロノーム（Metronome）**

### 1.2 目的・課題
- **解決したい課題**: リズムを取りたい、音楽的な遊び
- **ターゲットユーザー**: 作曲家、楽器練習者、音楽愛好家
- **利用シーン**: お遊び、作曲、楽器練習、リズムトレーニング
- **コンセプト**: シンプルで使いやすいメトロノーム

### 1.3 成功基準
- 正確なテンポで音が鳴る
- 視覚的にもリズムがわかりやすい
- シンプルで直感的な操作性
- AIによるリズムトレーニング提案が役立つ

---

## 2. 必須要件（中期以降の方針）

### 2.1 AI内蔵アプリケーション
- ✅ Google AI Studio API使用（31〜33番と同じ）
- ✅ リズムトレーニングの提案生成
- ✅ ジャンル別の推奨BPM提案生成

### 2.2 PWA標準実装
- ✅ オフライン対応
  - **メトロノーム機能**: オフラインでも動作
  - **AI生成**: オンライン必須
- ✅ インストール可能
- ✅ レスポンシブデザイン

### 2.3 既存アプリとの連携
- ✅ **30番「音当てクイズ」と連携可能性**
  - 音楽・リズム系アプリとして関連
- ✅ **23番「サウンドスケッチャー」と連携可能性**
  - リズム・音楽制作系として統合
  - 将来拡張：メトロノームと連携した音楽制作

---

## 3. 機能仕様

### 3.1 コア機能

#### 3.1.1 テンポ設定
- **BPM範囲**: 40〜240 BPM
- **設定方法**:
  - スライダー（1 BPM刻み）
  - 数値入力（直接入力）
  - タップテンポ（ボタンをタップしてBPM検出）
- **デフォルト**: 120 BPM

#### 3.1.2 拍子設定
- **対応拍子**（メジャーなもの全て）:
  - 2/4（マーチ等）
  - 3/4（ワルツ等）
  - 4/4（最も一般的）
  - 5/4（変拍子）
  - 6/8（スウィング等）
  - 7/8（変拍子）
  - 9/8（変拍子）
  - 12/8（シャッフル等）
- **デフォルト**: 4/4

#### 3.1.3 音の種類
- **音色選択**:
  - クラシック（木製クリック音）
  - デジタル（電子音）
  - ドラムスティック
  - ベル
  - シンセ
- **アクセント**:
  - 強拍（1拍目）に強いアクセント
  - アクセントのON/OFF切り替え
- **サブディビジョン**（1拍の細分化）:
  - 4分音符（基本）
  - 8分音符（2分割）
  - 16分音符（4分割）
  - 3連符

#### 3.1.4 視覚的メトロノーム
- **点滅表示**:
  - 各拍で画面が点滅
  - 強拍は色が変わる
- **振り子アニメーション**:
  - 伝統的なメトロノームの振り子を模擬
  - 左右にスムーズに揺れる
- **BPM数値表示**:
  - 現在のテンポを大きく表示

#### 3.1.5 プリセット機能
- **よく使うテンポ保存**:
  - プリセット名
  - BPM
  - 拍子
  - 音色
  - サブディビジョン
- **ジャンル別プリセット**（初期値）:
  - Largo（40-60 BPM）
  - Adagio（66-76 BPM）
  - Andante（76-108 BPM）
  - Moderato（108-120 BPM）
  - Allegro（120-156 BPM）
  - Presto（168-200 BPM）
  - ロック（120-140 BPM）
  - ジャズ（100-160 BPM）
  - テクノ（120-150 BPM）

#### 3.1.6 タップテンポ機能
- **操作**: ボタンを連続タップ
- **検出**: 3回以上のタップで平均BPMを計算
- **表示**: 検出したBPMを自動設定

#### 3.1.7 AI生成コンテンツ（Google AI Studio）
- **生成タイミング**: 生成ボタンを押した時（手動トリガー）
- **キャッシュ**: 利用しない（毎回新しいコンテンツを生成）
- **生成内容**:
  1. **リズムトレーニングの提案**
     - 現在のBPMに合わせた練習メニュー
     - 段階的なテンポアップの提案
  2. **ジャンル別の推奨BPM提案**
     - 選択した音楽ジャンルに適したBPM
     - ジャンル特有のリズムパターン提案

### 3.2 データ保存（ローカルストレージ）
- プリセット設定（ユーザー作成）
- 最後に使用した設定（BPM、拍子、音色、サブディビジョン）
- APIキー（ユーザー設定）

---

## 4. 非機能要件

### 4.1 デザイン要求
- **テーマ**: シンプル、ミニマル
- **色使い**: 音楽的なイメージ
  - メイン: ダークグレー・ブラック
  - アクセント: 音楽的な色（青・緑系）
  - 強拍: オレンジ・赤系
- **アニメーション**:
  - 振り子のスムーズな揺れ
  - 点滅のタイミング正確性
  - UIトランジション

### 4.2 パフォーマンス
- **タイミング精度**: ±5ms以内
- **音声遅延**: 最小化（Web Audio API使用）
- **CPU使用率**: 低く抑える（バックグラウンド動作考慮）

### 4.3 互換性
- モダンブラウザ（Chrome, Edge, Safari, Firefox最新版）
- モバイル・タブレット対応
- PWAとしてインストール可能
- Web Audio API対応ブラウザ

---

## 5. 技術制約

### 5.1 使用API
- **Google AI Studio API**
  - モデル: Gemini Pro推奨
  - APIキー管理: ユーザー入力 + ローカルストレージ
  - 31〜33番と共通
- **Web Audio API**
  - 音声生成・再生
  - 高精度タイミング制御

### 5.2 データ保存
- **ローカルストレージ**
  - 容量制限: 5MB以内
  - データ構造: JSON形式

### 5.3 音声処理
- **Web Audio API**
  - AudioContext使用
  - OscillatorNode（音色生成）
  - GainNode（音量制御）

---

## 6. 画面構成

### 6.1 メイン画面
```
┌─────────────────────────────────────┐
│  🎵 メトロノーム                     │
├─────────────────────────────────────┤
│                                     │
│        [振り子アニメーション]         │
│                                     │
│          【 120 】 BPM              │
│       ━━━━━●━━━━━ (スライダー)     │
│                                     │
│  [40] BPM入力 [240]                │
│  [タップテンポ ボタン]               │
├─────────────────────────────────────┤
│  拍子: [4/4 ▼]                      │
│  音色: [クラシック ▼]               │
│  □ アクセント  □ サブディビジョン     │
│     (8分音符 ▼)                     │
├─────────────────────────────────────┤
│  [▶ 再生 / ⏸ 停止]                 │
├─────────────────────────────────────┤
│  プリセット:                         │
│  [Allegro] [ロック] [ジャズ]        │
│  [+ 新規プリセット]                  │
├─────────────────────────────────────┤
│  [✨ AI提案を生成 ボタン]            │
├─────────────────────────────────────┤
│  🎯 リズムトレーニング:               │
│  [AI生成コンテンツ]                  │
├─────────────────────────────────────┤
│  🎼 ジャンル別BPM提案:                │
│  [AI生成コンテンツ]                  │
└─────────────────────────────────────┘
```

### 6.2 設定画面
- APIキー入力
- プリセット管理
- データクリア
- アプリ情報

---

## 7. 開発スコープ外（将来拡張）

- 複雑なリズムパターン（ポリリズム等）
- 録音機能
- 23番「サウンドスケッチャー」との統合
- MIDI出力対応
- カスタム音色アップロード

---

## 8. リスクと対策

### 8.1 技術リスク
| リスク | 対策 |
|--------|------|
| Web Audio APIのタイミング精度 | AudioContext.currentTime使用、スケジューリング最適化 |
| ブラウザ間の音声遅延差 | 各ブラウザでテスト、調整値設定 |
| バックグラウンド動作の制限 | PWA Service Worker活用 |
| AI生成の遅延 | ローディング表示、タイムアウト設定 |

### 8.2 運用リスク
| リスク | 対策 |
|--------|------|
| APIキー未設定時のUX | デモモード・プレースホルダー表示 |
| 音声再生の失敗 | エラーハンドリング、フォールバック |

---

## 9. 既存アプリとの連携

### 9.1 連携対象（将来拡張）
- **23番「サウンドスケッチャー」**
  - メトロノームと連携した音楽制作
  - リズムパターンの統合
- **30番「音当てクイズ」**
  - リズム感クイズとの統合
  - 音楽・リズム系アプリグループ形成

---

## 10. メトロノーム用語集

| 用語 | 意味 |
|------|------|
| BPM | Beats Per Minute（1分間の拍数） |
| 拍子 | リズムのパターン（4/4 = 4分の4拍子） |
| アクセント | 強調される拍（通常は1拍目） |
| サブディビジョン | 1拍の細分化（8分音符、16分音符等） |
| タップテンポ | タップしてBPMを検出する機能 |

---

## 11. 次ステップ

1. ✅ 要件定義書レビュー・承認
2. ⬜ 技術設計書作成
3. ⬜ 実装計画書作成
4. ⬜ 実装開始（Claude Code on the Web）

---

**作成者**: クロ
**レビュー待ち**: あおいさん
